<!doctype html>
<html class="no-js" lang="zh_CN">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />
<link rel="index" title="索引" href="../../../genindex.html" /><link rel="search" title="搜索" href="../../../search.html" /><link rel="next" title="Creating reStructuredText Interpreted Text Roles" href="rst-roles.html" /><link rel="prev" title="Docutils Internationalization" href="i18n.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.png"/><meta name="generator" content="sphinx-4.3.0, furo 2021.11.15"/>
        <title>Creating reStructuredText Directives - docutilsx 0.0.1 文档</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=916d6ed8f59335acffa15474ff504849343d4c76" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=0af69da206d614734f649b27d4cdc2dd6c31f41d" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">docutilsx 0.0.1 文档</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">docutilsx 0.0.1 文档</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder=搜索 name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">导航</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../web/index.html">Docutils：文档实用工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web/rst.html"></a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Docutils 项目文档概述</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../_toc/info.html">项目基础</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../README.html">Docutils 0.18.1b.dev 自述</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FAQ.html"><span class="sectnum">1</span> Docutils 常见问题（Frequently Asked Questions）</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../BUGS.html">Docutils 错误</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../COPYING.html">Docutils 分发</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../RELEASE-NOTES.html">Docutils 发行说明</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../HISTORY.html">Docutils 历史</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../THANKS.html">致谢</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../_toc/user/index.html">用户相关</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../_toc/user/general.html">Docutils 通用</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/tools.html">Docutils Front-End Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/config.html">Docutils Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/mailing-lists.html">Docutils Mailing Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/links.html">Docutils Link List</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../_toc/user/write.html">写作相关</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/html.html">Docutils HTML writers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/slide-shows.html">Easy Slide Shows With reST &amp; S5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/latex.html"><span class="sectnum">1</span> Generating LaTeX with Docutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/odt.html"><span class="sectnum">1</span> Odt Writer for Docutils</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../_toc/user/rst.html">reStructuredText</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/rst/quickstart.html">A ReStructuredText Primer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/rst/cheatsheet.html">The reStructuredText Cheat Sheet: Syntax Reminders</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../_toc/user/editor.html">编辑器支持</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/emacs.html">Emacs Support for reStructuredText</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../_toc/user/other.html">其他</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../user/manpage.html">manpage writer for Docutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user/smartquotes.html">Smart Quotes for Docutils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../_toc/ref/index.html">所有组的参考资料</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../_toc/ref/general.html">Docutils 通用参考</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../ref/doctree.html">The Docutils Document Tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ref/transforms.html">Docutils Transforms</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../_toc/ref/rst.html">reStructuredText</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../ref/rst/introduction.html">An Introduction to reStructuredText</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ref/rst/restructuredtext.html">reStructuredText Markup Specification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ref/rst/directives.html">reStructuredText Directives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ref/rst/roles.html">reStructuredText Interpreted Text Roles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ref/rst/definitions.html">reStructuredText Standard Definition Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ref/rst/mathematics.html"><span class="sectnum">1</span> LaTeX syntax for mathematics</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../web/mirror/setext.html">Setext 文档镜像</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../_toc/peps.html">Python Enhancement Proposals</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../peps/pep-0256.html">PEP 256: Docstring Processing System Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peps/pep-0257.html">PEP 257: Docstring Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peps/pep-0258.html">PEP 258: Docutils Design Specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../peps/pep-0287.html">PEP 287: reStructuredText Docstring Format</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../_toc/api.html">API Reference Material for Client-Developers</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/publisher.html">The Docutils Publisher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/cmdline-tool.html">Inside A Docutils Command-Line Front-End Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/runtime-settings.html">Docutils Runtime Settings</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../../_toc/howto.html">Instructions for Developers</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="security.html">Deploying Docutils Securely</a></li>
<li class="toctree-l2"><a class="reference internal" href="html-stylesheets.html">Writing HTML (CSS) Stylesheets for Docutils</a></li>
<li class="toctree-l2"><a class="reference internal" href="i18n.html">Docutils Internationalization</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Creating reStructuredText Directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="rst-roles.html">Creating reStructuredText Interpreted Text Roles</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../_toc/dev/index.html">Development Notes and Plans for Core-Developers</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../_toc/dev/general.html">Docutils 通用参考</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev/hacking.html">Docutils Hacker’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/distributing.html">Docutils Distributor’s Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/todo.html">Docutils To Do List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/policies.html">Docutils Project Policies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/website.html">Docutils Web Site</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/release.html">Docutils Release Procedure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/repository.html">Docutils 版本库</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/testing.html">Docutils Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/semantics.html">Docstring Semantics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/pysource.html">Python Source Reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/enthought-plan.html"><span class="sectnum">1</span> Plan for Enthought API Documentation Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/enthought-rfp.html"><span class="sectnum">1</span> Enthought API Documentation Tool</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../_toc/dev/rst.html">reStructuredText 参考</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev/rst/alternatives.html">A Record of reStructuredText Syntax Alternatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/rst/problems.html">Problems With StructuredText</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../_toc/sandbox.html">sandbox</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../sandbox/README.html">Sandbox 自述</a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="creating-restructuredtext-directives">
<h1>Creating <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> Directives<a class="headerlink" href="#creating-restructuredtext-directives" title="永久链接至标题">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Authors</dt>
<dd class="field-odd"><p>Dethe Elza, David Goodger, Lea Wiemann</p>
</dd>
<dt class="field-even">Contact</dt>
<dd class="field-even"><p><a class="reference external" href="mailto:docutils-develop%40lists.sourceforge.net">docutils-develop<span>@</span>lists<span>.</span>sourceforge<span>.</span>net</a></p>
</dd>
<dt class="field-odd">Date</dt>
<dd class="field-odd"><p>$Date$</p>
</dd>
<dt class="field-even">Revision</dt>
<dd class="field-even"><p>$Revision$</p>
</dd>
<dt class="field-odd">Copyright</dt>
<dd class="field-odd"><p>This document has been placed in the public domain.</p>
</dd>
</dl>
<p>Directives are the primary extension mechanism of reStructuredText.
This document aims to make the creation of new directives as easy and
understandable as possible.  There are only a couple of
reStructuredText-specific features the developer needs to know to
create a basic directive.</p>
<p>The syntax of directives is detailed in the <a class="reference external" href="../ref/rst/restructuredtext.html#directives">reStructuredText Markup
Specification</a>, and standard directives are described in
<a class="reference external" href="../ref/rst/directives.html">reStructuredText Directives</a>.</p>
<p>Directives are a reStructuredText markup/parser concept.  There is no
“directive” document tree element, no single element that corresponds
exactly to the concept of directives.  Instead, choose the most
appropriate elements from the existing Docutils elements.  Directives
build structures using the existing building blocks.  See <a class="reference external" href="../ref/doctree.html">The
Docutils Document Tree</a> and the <code class="docutils literal notranslate"><span class="pre">docutils.nodes</span></code> module for more
about the building blocks of Docutils documents.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#creating-restructuredtext-directives" id="id4">Creating reStructuredText Directives</a></p>
<ul>
<li><p><a class="reference internal" href="#the-directive-class" id="id5">The Directive Class</a></p></li>
<li><p><a class="reference internal" href="#option-conversion-functions" id="id6">Option Conversion Functions</a></p></li>
<li><p><a class="reference internal" href="#error-handling" id="id7">Error Handling</a></p></li>
<li><p><a class="reference internal" href="#register-the-directive" id="id8">Register the Directive</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id9">Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#admonitions" id="id10">Admonitions</a></p></li>
<li><p><a class="reference internal" href="#image" id="id11">“image”</a></p></li>
<li><p><a class="reference internal" href="#the-pending-element" id="id12">The Pending Element</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="the-directive-class">
<h2><a class="toc-backref" href="#id5">The Directive Class</a><a class="headerlink" href="#the-directive-class" title="永久链接至标题">¶</a></h2>
<p>Directives are created by defining a directive class that inherits
from <code class="docutils literal notranslate"><span class="pre">docutils.parsers.rst.Directive</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.parsers</span> <span class="kn">import</span> <span class="n">rst</span>

<span class="k">class</span> <span class="nc">MyDirective</span><span class="p">(</span><span class="n">rst</span><span class="o">.</span><span class="n">Directive</span><span class="p">):</span>

    <span class="o">...</span>
</pre></div>
</div>
<p>To understand how to implement the directive, let’s have a look at the
docstring of the <code class="docutils literal notranslate"><span class="pre">Directive</span></code> base class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">docutils.parsers</span> <span class="kn">import</span> <span class="n">rst</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">rst</span><span class="o">.</span><span class="n">Directive</span><span class="o">.</span><span class="vm">__doc__</span>

<span class="go">    Base class for reStructuredText directives.</span>

<span class="go">    The following attributes may be set by subclasses.  They are</span>
<span class="go">    interpreted by the directive parser (which runs the directive</span>
<span class="go">    class):</span>

<span class="go">    - `required_arguments`: The number of required arguments (default:</span>
<span class="go">      0).</span>

<span class="go">    - `optional_arguments`: The number of optional arguments (default:</span>
<span class="go">      0).</span>

<span class="go">    - `final_argument_whitespace`: A boolean, indicating if the final</span>
<span class="go">      argument may contain whitespace (default: False).</span>

<span class="go">    - `option_spec`: A dictionary, mapping known option names to</span>
<span class="go">      conversion functions such as `int` or `float` (default: {}, no</span>
<span class="go">      options).  Several conversion functions are defined in the</span>
<span class="go">      directives/__init__.py module.</span>

<span class="go">      Option conversion functions take a single parameter, the option</span>
<span class="go">      argument (a string or ``None``), validate it and/or convert it</span>
<span class="go">      to the appropriate form.  Conversion functions may raise</span>
<span class="go">      `ValueError` and `TypeError` exceptions.</span>

<span class="go">    - `has_content`: A boolean; True if content is allowed.  Client</span>
<span class="go">      code must handle the case where content is required but not</span>
<span class="go">      supplied (an empty content list will be supplied).</span>

<span class="go">    Arguments are normally single whitespace-separated words.  The</span>
<span class="go">    final argument may contain whitespace and/or newlines if</span>
<span class="go">    `final_argument_whitespace` is True.</span>

<span class="go">    If the form of the arguments is more complex, specify only one</span>
<span class="go">    argument (either required or optional) and set</span>
<span class="go">    `final_argument_whitespace` to True; the client code must do any</span>
<span class="go">    context-sensitive parsing.</span>

<span class="go">    When a directive implementation is being run, the directive class</span>
<span class="go">    is instantiated, and the `run()` method is executed.  During</span>
<span class="go">    instantiation, the following instance variables are set:</span>

<span class="go">    - ``name`` is the directive type or name (string).</span>

<span class="go">    - ``arguments`` is the list of positional arguments (strings).</span>

<span class="go">    - ``options`` is a dictionary mapping option names (strings) to</span>
<span class="go">      values (type depends on option conversion functions; see</span>
<span class="go">      `option_spec` above).</span>

<span class="go">    - ``content`` is a list of strings, the directive content line by line.</span>

<span class="go">    - ``lineno`` is the line number of the first line of the directive.</span>

<span class="go">    - ``content_offset`` is the line offset of the first line of the content from</span>
<span class="go">      the beginning of the current input.  Used when initiating a nested parse.</span>

<span class="go">    - ``block_text`` is a string containing the entire directive.</span>

<span class="go">    - ``state`` is the state which called the directive function.</span>

<span class="go">    - ``state_machine`` is the state machine which controls the state which called</span>
<span class="go">      the directive function.</span>

<span class="go">    Directive functions return a list of nodes which will be inserted</span>
<span class="go">    into the document tree at the point where the directive was</span>
<span class="go">    encountered.  This can be an empty list if there is nothing to</span>
<span class="go">    insert.</span>

<span class="go">    For ordinary directives, the list must contain body elements or</span>
<span class="go">    structural elements.  Some directives are intended specifically</span>
<span class="go">    for substitution definitions, and must return a list of `Text`</span>
<span class="go">    nodes and/or inline elements (suitable for inline insertion, in</span>
<span class="go">    place of the substitution reference).  Such directives must verify</span>
<span class="go">    substitution definition context, typically using code like this::</span>

<span class="go">        if not isinstance(state, states.SubstitutionDef):</span>
<span class="go">            error = state_machine.reporter.error(</span>
<span class="go">                'Invalid context: the "%s" directive can only be used '</span>
<span class="go">                'within a substitution definition.' % (name),</span>
<span class="go">                nodes.literal_block(block_text, block_text), line=lineno)</span>
<span class="go">            return [error]</span>

<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</section>
<section id="option-conversion-functions">
<h2><a class="toc-backref" href="#id6">Option Conversion Functions</a><a class="headerlink" href="#option-conversion-functions" title="永久链接至标题">¶</a></h2>
<p>An option specification (<code class="docutils literal notranslate"><span class="pre">Directive.option_spec</span></code>) must be defined
detailing the options available to the directive.  An option spec is a
mapping of option name to conversion function; conversion functions
are applied to each option value to check validity and convert them to
the expected type.  Python’s built-in conversion functions are often
usable for this, such as <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>.  Other useful conversion
functions are included in the <code class="docutils literal notranslate"><span class="pre">docutils.parsers.rst.directives</span></code>
package (in the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> module):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flag</span></code>: For options with no option arguments.  Checks for an
argument (raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if found), returns <code class="docutils literal notranslate"><span class="pre">None</span></code> for
valid flag options.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unchanged_required</span></code>: Returns the text argument, unchanged.
Raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if no argument is found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unchanged</span></code>: Returns the text argument, unchanged.  Returns an
empty string (“”) if no argument is found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code>: Returns the path argument unwrapped (with newlines
removed).  Raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if no argument is found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uri</span></code>: Returns the URI argument with whitespace removed.  Raises
<code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if no argument is found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nonnegative_int</span></code>: Checks for a nonnegative integer argument,
and raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if not.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class_option</span></code>: Converts the argument into an ID-compatible
string and returns it.  Raises <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if no argument is
found.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unicode_code</span></code>: Convert a Unicode character code to a Unicode
character.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">single_char_or_unicode</span></code>: A single character is returned as-is.
Unicode characters codes are converted as in <code class="docutils literal notranslate"><span class="pre">unicode_code</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">single_char_or_whitespace_or_unicode</span></code>: As with
<code class="docutils literal notranslate"><span class="pre">single_char_or_unicode</span></code>, but “tab” and “space” are also
supported.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">positive_int</span></code>: Converts the argument into an integer.  Raises
ValueError for negative, zero, or non-integer values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">positive_int_list</span></code>: Converts a space- or comma-separated list
of integers into a Python list of integers.  Raises ValueError for
non-positive-integer values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encoding</span></code>: Verifies the encoding argument by lookup.  Raises
ValueError for unknown encodings.</p></li>
</ul>
<p>A further utility function, <code class="docutils literal notranslate"><span class="pre">choice</span></code>, is supplied to enable
options whose argument must be a member of a finite set of possible
values.  A custom conversion function must be written to use it.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="kn">import</span> <span class="n">directives</span>

<span class="k">def</span> <span class="nf">yesno</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">directives</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="p">(</span><span class="s1">'yes'</span><span class="p">,</span> <span class="s1">'no'</span><span class="p">))</span>
</pre></div>
</div>
<p>For example, here is an option spec for a directive which allows two
options, “name” and “value”, each with an option argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'name'</span><span class="p">:</span> <span class="n">unchanged</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">:</span> <span class="nb">int</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="error-handling">
<h2><a class="toc-backref" href="#id7">Error Handling</a><a class="headerlink" href="#error-handling" title="永久链接至标题">¶</a></h2>
<p>If your directive implementation encounters an error during
processing, you should call <code class="docutils literal notranslate"><span class="pre">self.error()</span></code> inside the <code class="docutils literal notranslate"><span class="pre">run()</span></code>
method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">error_condition</span><span class="p">:</span>
    <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">'Error message.'</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">self.error()</span></code> method will immediately raise an exception that
will be caught by the reStructuredText directive handler.  The
directive handler will then insert an error-level system message in
the document at the place where the directive occurred.</p>
<p>Instead of <code class="docutils literal notranslate"><span class="pre">self.error</span></code>, you can also use <code class="docutils literal notranslate"><span class="pre">self.severe</span></code> and
<code class="docutils literal notranslate"><span class="pre">self.warning</span></code> for more or less severe problems.</p>
<p>If you want to return a system message <em>and</em> document contents, you need to
create the system message yourself instead of using the <code class="docutils literal notranslate"><span class="pre">self.error</span></code>
convenience method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Create node(s).</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="c1"># Node list to return.</span>
    <span class="n">node_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">error_condition</span><span class="p">:</span>
         <span class="c1"># Create system message.</span>
         <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reporter</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
             <span class="s1">'Error in "</span><span class="si">%s</span><span class="s1">" directive: Your error message.'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
             <span class="n">nodes</span><span class="o">.</span><span class="n">literal_block</span><span class="p">(</span><span class="n">block_text</span><span class="p">,</span> <span class="n">block_text</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="n">lineno</span><span class="p">)</span>
         <span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">node_list</span>
</pre></div>
</div>
</section>
<section id="register-the-directive">
<h2><a class="toc-backref" href="#id8">Register the Directive</a><a class="headerlink" href="#register-the-directive" title="永久链接至标题">¶</a></h2>
<ul>
<li><p>If the directive is a general-use <strong>addition to the Docutils core</strong>,
it must be registered with the parser and language mappings added:</p>
<ol class="arabic simple">
<li><p>Register the new directive using its canonical name in
<code class="docutils literal notranslate"><span class="pre">docutils/parsers/rst/directives/__init__.py</span></code>, in the
<code class="docutils literal notranslate"><span class="pre">_directive_registry</span></code> dictionary.  This allows the
reStructuredText parser to find and use the directive.</p></li>
<li><p>Add an entry to the <code class="docutils literal notranslate"><span class="pre">directives</span></code> dictionary in
<code class="docutils literal notranslate"><span class="pre">docutils/parsers/rst/languages/en.py</span></code> for the directive, mapping
the English name to the canonical name (both lowercase).  Usually
the English name and the canonical name are the same.</p></li>
<li><p>Update all the other language modules as well.  For languages in
which you are proficient, please add translations.  For other
languages, add the English directive name plus “(translation
required)”.</p></li>
</ol>
</li>
<li><p>If the directive is <strong>application-specific</strong>, use the
<code class="docutils literal notranslate"><span class="pre">register_directive</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="kn">import</span> <span class="n">directives</span>
<span class="n">directives</span><span class="o">.</span><span class="n">register_directive</span><span class="p">(</span><span class="n">directive_name</span><span class="p">,</span> <span class="n">directive_class</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#id9">Examples</a><a class="headerlink" href="#examples" title="永久链接至标题">¶</a></h2>
<p>For the most direct and accurate information, “Use the Source, Luke!”.
All standard directives are documented in <a class="reference external" href="../ref/rst/directives.html">reStructuredText
Directives</a>, and the source code implementing them is located in the
<code class="docutils literal notranslate"><span class="pre">docutils/parsers/rst/directives</span></code> package.  The <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>
module contains a mapping of directive name to module and function
name.  Several representative directives are described below.</p>
<section id="admonitions">
<h3><a class="toc-backref" href="#id10">Admonitions</a><a class="headerlink" href="#admonitions" title="永久链接至标题">¶</a></h3>
<p><a class="reference external" href="../ref/rst/directives.html#specific-admonitions">Admonition directives</a>, such as “note” and “caution”, are quite
simple.  They have no directive arguments or options.  Admonition
directive content is interpreted as ordinary reStructuredText.</p>
<p>The resulting document tree for a simple reStructuredText line
“<code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">note::</span> <span class="pre">This</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">note.</span></code>” looks as follows:</p>
<blockquote>
<div><dl class="simple">
<dt>&lt;note&gt;</dt><dd><dl class="simple">
<dt>&lt;paragraph&gt;</dt><dd><p>This is a note.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>The directive class for the “note” directive simply derives from a
generic admonition directive class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Note</span><span class="p">(</span><span class="n">BaseAdmonition</span><span class="p">):</span>

    <span class="n">node_class</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">note</span>
</pre></div>
</div>
<p>Note that the only thing distinguishing the various admonition
directives is the element (node class) generated.  In the code above,
the node class is set as a class attribute and is read by the
<code class="docutils literal notranslate"><span class="pre">run()</span></code> method of <code class="docutils literal notranslate"><span class="pre">BaseAdmonition</span></code>, where the actual processing
takes place:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import Docutils document tree nodes module.</span>
<span class="kn">from</span> <span class="nn">docutils</span> <span class="kn">import</span> <span class="n">nodes</span>
<span class="c1"># Import Directive base class.</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="kn">import</span> <span class="n">Directive</span>

<span class="k">class</span> <span class="nc">BaseAdmonition</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>

    <span class="n">required_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">optional_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">final_argument_whitespace</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">option_spec</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">has_content</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">node_class</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="sd">"""Subclasses must set this to the appropriate admonition node class."""</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Raise an error if the directive does not have contents.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_has_content</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="c1"># Create the admonition node, to be populated by `nested_parse`.</span>
        <span class="n">admonition_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_class</span><span class="p">(</span><span class="n">rawsource</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
        <span class="c1"># Parse the directive contents.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">nested_parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content_offset</span><span class="p">,</span>
                                <span class="n">admonition_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">admonition_node</span><span class="p">]</span>
</pre></div>
</div>
<p>Three things are noteworthy in the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method above:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">admonition_node</span> <span class="pre">=</span> <span class="pre">self.node_class(text)</span></code> line creates the
wrapper element, using the class set by the specific admonition
subclasses (as in note, <code class="docutils literal notranslate"><span class="pre">node_class</span> <span class="pre">=</span> <span class="pre">nodes.note</span></code>).</p></li>
<li><p>The call to <code class="docutils literal notranslate"><span class="pre">state.nested_parse()</span></code> is what does the actual
processing.  It parses the directive content and adds any generated
elements as child elements of <code class="docutils literal notranslate"><span class="pre">admonition_node</span></code>.</p></li>
<li><p>If there was no directive content, the <code class="docutils literal notranslate"><span class="pre">assert_has_content()</span></code>
convenience method raises an error exception by calling
<code class="docutils literal notranslate"><span class="pre">self.error()</span></code> (see <a class="reference internal" href="#error-handling">Error Handling</a> above).</p></li>
</ul>
</section>
<section id="image">
<h3><a class="toc-backref" href="#id11">“image”</a><a class="headerlink" href="#image" title="永久链接至标题">¶</a></h3>
<p>The “<a class="reference external" href="../ref/rst/directives.html#image">image</a>” directive is used to insert a picture into a document.
This directive has one argument, the path to the image file, and
supports several options.  There is no directive content.  Here’s an
early version of the image directive class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import Docutils document tree nodes module.</span>
<span class="kn">from</span> <span class="nn">docutils</span> <span class="kn">import</span> <span class="n">nodes</span>
<span class="c1"># Import ``directives`` module (contains conversion functions).</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="kn">import</span> <span class="n">directives</span>
<span class="c1"># Import Directive base class.</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="kn">import</span> <span class="n">Directive</span>

<span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="n">argument</span><span class="p">):</span>
    <span class="sd">"""Conversion function for the "align" option."""</span>
    <span class="k">return</span> <span class="n">directives</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="p">(</span><span class="s1">'left'</span><span class="p">,</span> <span class="s1">'center'</span><span class="p">,</span> <span class="s1">'right'</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">Directive</span><span class="p">):</span>

    <span class="n">required_arguments</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">optional_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">final_argument_whitespace</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">option_spec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'alt'</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
                   <span class="s1">'height'</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">nonnegative_int</span><span class="p">,</span>
                   <span class="s1">'width'</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">nonnegative_int</span><span class="p">,</span>
                   <span class="s1">'scale'</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">nonnegative_int</span><span class="p">,</span>
                   <span class="s1">'align'</span><span class="p">:</span> <span class="n">align</span><span class="p">,</span>
                   <span class="p">}</span>
    <span class="n">has_content</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reference</span> <span class="o">=</span> <span class="n">directives</span><span class="o">.</span><span class="n">uri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">'uri'</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference</span>
        <span class="n">image_node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">rawsource</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">block_text</span><span class="p">,</span>
                                 <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">image_node</span><span class="p">]</span>
</pre></div>
</div>
<p>Several things are noteworthy in the code above:</p>
<ul class="simple">
<li><p>The “image” directive requires a single argument, which is allowed
to contain whitespace (<code class="docutils literal notranslate"><span class="pre">final_argument_whitespace</span> <span class="pre">=</span> <span class="pre">True</span></code>).  This
is to allow for long URLs which may span multiple lines.  The first
line of the <code class="docutils literal notranslate"><span class="pre">run()</span></code> method joins the URL, discarding any embedded
whitespace.</p></li>
<li><p>The reference is added to the <code class="docutils literal notranslate"><span class="pre">options</span></code> dictionary under the
“uri” key; this becomes an attribute of the <code class="docutils literal notranslate"><span class="pre">nodes.image</span></code> element
object.  Any other attributes have already been set explicitly in
the reStructuredText source text.</p></li>
</ul>
</section>
<section id="the-pending-element">
<h3><a class="toc-backref" href="#id12">The Pending Element</a><a class="headerlink" href="#the-pending-element" title="永久链接至标题">¶</a></h3>
<p>Directives that cause actions to be performed <em>after</em> the complete
document tree has been generated can be implemented using a
<code class="docutils literal notranslate"><span class="pre">pending</span></code> node.  The <code class="docutils literal notranslate"><span class="pre">pending</span></code> node causes a <a class="reference external" href="../ref/transforms.html">transform</a> to be run
after the document has been parsed.</p>
<p>For an example usage of the <code class="docutils literal notranslate"><span class="pre">pending</span></code> node, see the implementation
of the <code class="docutils literal notranslate"><span class="pre">contents</span></code> directive in
<a class="reference external" href="http://docutils.sf.net/docutils/parsers/rst/directives/parts.py">docutils.parsers.rst.directives.parts</a>.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="rst-roles.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Creating reStructuredText Interpreted Text Roles</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="i18n.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Docutils Internationalization</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, xinetzone |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="../../../_sources/docutils/docs/howto/rst-directives.txt"
               rel="nofollow">
              显示源代码
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            目录
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Creating reStructuredText Directives</a><ul>
<li><a class="reference internal" href="#the-directive-class">The Directive Class</a></li>
<li><a class="reference internal" href="#option-conversion-functions">Option Conversion Functions</a></li>
<li><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li><a class="reference internal" href="#register-the-directive">Register the Directive</a></li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#admonitions">Admonitions</a></li>
<li><a class="reference internal" href="#image">“image”</a></li>
<li><a class="reference internal" href="#the-pending-element">The Pending Element</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/translations.js"></script>
    </body>
</html>